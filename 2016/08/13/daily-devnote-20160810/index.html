<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 2016.08.10 오늘의 개발노트 · SPHERE</title><meta name="description" content="2016.08.10 오늘의 개발노트 - SeungHyun Lee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://zero2hex.github.io/atom.xml" title="SPHERE"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/zero2hex" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">2016.08.10 오늘의 개발노트</h1><div class="post-info">2016년 8월 13일</div><div class="post-content"><h2 id="Spring-Data-REST의-Projection-사용-시-주의사항"><a href="#Spring-Data-REST의-Projection-사용-시-주의사항" class="headerlink" title="Spring Data REST의 Projection 사용 시 주의사항"></a>Spring Data REST의 Projection 사용 시 주의사항</h2><p>Spring Data REST를 이용해 서버를 구성 중, 한 엔티티에서 다른 엔티티 내용을 함께 표시할 일이 있었다.</p>
<p>이런 경우 <code>@Projection</code> 어노테이션을 이용해 일부를 제외 혹은 포함 시켜 표현해 줄 수 있는데, 내 경우에는 Spring Boot의 버전을 바꾸고 Dependency를 바꿔봐도 표현이 되지 않는 것이었다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Projection</span>(name = <span class="string">"cfgkey"</span> , types = &#123; ConfigValueEntity.class &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigValueProjection</span> </span>&#123;</div><div class="line">    <span class="function">ConfigKeyEntity <span class="title">getConfigKey</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">getConfigValue</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">getDescription</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">Date <span class="title">getTimestamp</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Projection</span>(name = <span class="string">"cfgkey"</span> , types = &#123; ConfigKeyEntity.class &#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ConfigKeyProjection</span> </span>&#123;</div><div class="line">    <span class="function">String <span class="title">getId</span><span class="params">()</span></span>;</div><div class="line">    <span class="function">String <span class="title">getFilename</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>분명 엔티티상에 <code>@Projection</code> 어노테이션을 붙이는것으로 설정은 끝이었고, 다른 코드를 붙일 필요는 없어보였다.</p>
<p>그리고 구글을 몇 시간이나 뒤진 끝에 마침내 Spring Data REST Reference에서 찾아낸 말은 다음과 같았다.</p>
<blockquote>
<p>How does Spring Data REST finds projection definitions?</p>
<ul>
<li>Any @Projection interface found in the same package as your entity definitions (or one of it’s sub-packages) is registered.</li>
<li>You can manually register via RepositoryRestConfiguration.getProjectionConfiguration().addProjection(…).</li>
</ul>
<p>In either situation, the interface with your projection MUST have the @Projection annotation.</p>
</blockquote>
<p>음, 서브패키지 폴더에 넣으랜다.</p>
<p>넣었더니, 된다. 허헣.</p>
<p>현 프로젝트에서 도메인 엔티티들은 <code>the.project.package.domain</code> 패키지에 포함시켜뒀고, 프로젝션을 위한 인터페이스는 <code>the.project.package.projection</code>에 포함시켜 둔 상태였다.</p>
<p>여기서 <code>the.project.package.projection</code> 패키지를 <code>the.project.package.domain.projection</code>으로 이동시키자 문제가 해결된 것이다.</p>
<p>정말 어이없으면서도, 레퍼런스 문서에서 이 중요한 문제를 경고 표시 하나 없이 2줄로 달랑 끝냈다는게 화가나기도 한다.</p>
<p>여튼, 이렇게 해결되서 아래와 같이 Projection이 문제없이 잘 작동하게 됐다.</p>
<p><strong>Projection 미적용</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</div><div class="line">  <span class="attr">"timestamp"</span>: <span class="string">"2016-08-10T01:05:23.000+0000"</span>,</div><div class="line">  <span class="attr">"configValue"</span>: <span class="string">"~~~"</span>,</div><div class="line">  <span class="attr">"_links"</span>: &#123;</div><div class="line">    <span class="attr">"self"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1&#123;?projection&#125;"</span>,</div><div class="line">      <span class="attr">"templated"</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"version"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/version"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"software"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/software"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"configKey"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/configKey"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Projection 적용</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</div><div class="line">  <span class="attr">"timestamp"</span>: <span class="string">"2016-08-10T01:05:23.000+0000"</span>,</div><div class="line">  <span class="attr">"configKey"</span>: &#123;</div><div class="line">    <span class="attr">"id"</span>: <span class="string">"dfs.hosts.exclude"</span>,</div><div class="line">    <span class="attr">"filename"</span>: <span class="string">"hdfs-site.xml"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"configValue"</span>: <span class="string">"~~~ "</span>,</div><div class="line">  <span class="attr">"_links"</span>: &#123;</div><div class="line">    <span class="attr">"self"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1&#123;?projection&#125;"</span>,</div><div class="line">      <span class="attr">"templated"</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"version"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/version"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"software"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/software"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"configKey"</span>: &#123;</div><div class="line">      <span class="attr">"href"</span>: <span class="string">"http://localhost:20080/api/configs/1/configKey"</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2016/08/14/daily-devnote-20160814/" class="prev">PREV</a><a href="/2016/08/08/daily-devnote-20160808/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'spherez';
var disqus_identifier = '2016/08/13/daily-devnote-20160810/';
var disqus_title = '2016.08.10 오늘의 개발노트';
var disqus_url = 'http://zero2hex.github.io/2016/08/13/daily-devnote-20160810/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//spherez.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 <a href="http://zero2hex.github.io">SeungHyun Lee</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-84373425-1",'auto');ga('send','pageview');</script></body></html>